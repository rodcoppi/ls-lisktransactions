  name: Daily Cache Update

  on:
    schedule:
      - cron: '5 0 * * *'
    workflow_dispatch:

  jobs:
    update-cache:
      runs-on: ubuntu-latest

      steps:
        - name: Update LuckySea Cache
          run: |
            echo "Starting daily cache update..."

            response=$(curl -s -w "%{http_code}" \
              -X POST \
              -H "Authorization: Bearer ${{ secrets.AUTO_UPDATE_TOKEN }}" \
              -H "Content-Type: application/json" \
              https://luckysea-lisk-analytics.vercel.app/api/auto-update)

            http_code="${response: -3}"
            response_body="${response%???}"

            echo "HTTP Status: $http_code"
            echo "Response: $response_body"

            if [ "$http_code" = "200" ]; then
              echo "✅ Update completed successfully!"
            else
              echo "❌ Update failed with status $http_code"
              exit 1
            fi

        - name: Log Summary
          run: |
            echo "LuckySea Analytics Updated"
            echo "Time: $(date -u)"
            echo "Next update: Tomorrow at 00:05 UTC"
